# 毕业证明管理系统
## 审批流程设计文档

---

## 一、文档概述

### 1.1 编写目的

本文档用于说明**毕业证明管理系统**中审批流程模块的整体设计方案，包括业务流程、数据模型、状态流转、角色分工及核心实现逻辑，为系统开发、测试及毕业设计答辩提供依据。

### 1.2 适用范围

- 毕业证明
- 在读证明
- 成绩证明
- 其他校内证明类业务（可扩展）

---

## 二、系统角色说明

| 角色 | 说明 |
|----|----|
| 学生 | 提交证明申请，查看审批进度与结果 |
| 辅导员 | 初审申请信息 |
| 学院管理员 | 复审申请内容 |
| 教务处 | 终审并确认证明有效性 |
| 系统 | 流程控制、数据存储、证明生成 |

---

## 三、业务流程总体说明

### 3.1 审批流程总体描述

毕业证明审批流程采用**模板化配置 + 多级审批**模式：

1. 学生选择证明模板并提交申请
2. 系统根据模板中配置的审批流程自动生成审批任务
3. 审批人按顺序逐级处理申请
4. 审批完成后系统自动生成证明文件

### 3.2 流程示意（文字描述）

```
学生提交申请
    ↓
生成申请记录
    ↓
指派第一级审批人
    ↓
审批操作（通过 / 拒绝 / 退回）
    ↓
是否还有下一审批级？
    ├─ 是 → 进入下一审批级
    └─ 否 → 生成毕业证明 → 流程结束
```

---

## 四、数据库设计说明（审批相关）

### 4.1 证明模板表（certificate_template）

#### 4.1.1 表作用

用于定义不同类型证明的模板信息及对应的审批流程配置。

#### 4.1.2 关键字段说明

| 字段 | 说明 |
|----|----|
| pk_ct | 模板主键 |
| template_content | 模板正文内容 |
| required_fields | 申请必填字段（JSON） |
| approval_flow | 审批流程配置（JSON） |

---

### 4.2 证明申请表（certificate_application）

#### 4.2.1 表作用

用于存储学生提交的具体证明申请实例，是审批流程的核心业务表。

#### 4.2.2 关键字段说明

| 字段 | 说明 |
|----|----|
| pk_ca | 申请主键 |
| pk_student | 学生 ID |
| pk_ct | 模板 ID |
| status | 申请状态 |
| current_approval_level | 当前审批级别 |
| pk_teacher | 当前审批人 |

---

### 4.3 审批记录表（approval_record）

#### 4.3.1 表作用

记录每一次审批操作，形成完整审批轨迹，用于审计与追溯。

#### 4.3.2 关键字段说明

| 字段 | 说明 |
|----|----|
| pk_ar | 审批记录主键 |
| approval_level | 审批级别 |
| approval_result | 审批结果 |
| approval_opinion | 审批意见 |
| approval_time | 审批时间 |

---

## 五、审批流程配置设计

### 5.1 approval_flow JSON 示例

```json
{
  "levels": [
    {"level": 1, "role": "counselor", "name": "辅导员初审"},
    {"level": 2, "role": "college_admin", "name": "学院复审"},
    {"level": 3, "role": "academic_office", "name": "教务处终审"}
  ],
  "reject_to": 0,
  "allow_return": true
}
```

### 5.2 字段说明

| 字段 | 说明 |
|----|----|
| levels | 审批级别列表 |
| role | 审批角色 |
| reject_to | 拒绝回退级别 |
| allow_return | 是否允许退回 |

---

## 六、审批状态流转设计

### 6.1 状态定义

| 状态值 | 含义 |
|----|----|
| 0 | 待审批 |
| 1 | 审批中 |
| 2 | 已通过 |
| 3 | 已拒绝 |
| 4 | 已撤销 |

---

## 七、审批操作处理逻辑

### 7.1 审批通过

- 记录审批结果
- 若存在下一审批级：
  - 更新当前审批级别
  - 指派下一审批人
- 若为终审：
  - 标记申请为“已通过”
  - 进入证明生成流程

### 7.2 审批拒绝

- 更新申请状态为“已拒绝”
- 记录拒绝原因
- 流程结束

### 7.3 审批退回

- 更新申请状态为“待审批”
- 回退审批级别
- 重新指派审批人

---

## 八、毕业证明生成设计

### 8.1 触发条件

- 申请状态为“已通过”

### 8.2 生成流程

1. 解析模板内容
2. 使用申请数据进行变量替换
3. 生成 PDF / Word 文件
4. 存储文件并回写文件地址

---

## 九、异常与边界情况处理

- 审批人不存在：流程中断并记录日志
- 模板被禁用：禁止新申请
- 学生撤销申请：状态置为“已撤销”

---

## 十、系统扩展性说明

- 可支持任意级审批流程
- 可扩展多种证明类型
- 可复用审批模块至其他业务系统

---

## 十一、总结

本审批流程设计方案结构清晰、职责分明，满足毕业证明管理系统在安全性、可扩展性及实际业务应用方面的需求，具备实际项目与毕业设计双重价值。

